# Fujitsu - TPAC 2020 Online Plugfest

Fujitsu provides two services:

- Sensor units (temperature, humidity, air pressure, human detection, etc.)
- A local proxy with local discovery

## Sensor units

Several sensors and Wi-Fi module(ESP32) are on a single board that has a WoT interface.
In this plugfest, 2 different types of TDs for this sensor unit are provided. One is the TD for the physical device that can be accessed directly, and another is the TD of the virutal devicefor generated by the local proxy described below.

### discovery of this device

search `_wot._tcp` service on plugfest VPN.

```
% avahi-browse -r _wot._tcp
+ vpn_vpn IPv4 fujitsu-sensor                                _wot._tcp            local
= vpn_vpn IPv4 fujitsu-sensor                                _wot._tcp            local
   hostname = [ESP32-3D71BF428EFC.local]
   address = [192.168.30.139]
   port = [80]
   txt = ["type=Thing" "td=/Things/td"]
```

### retrieving TD from this device

```
% curl http://192.168.30.139/Things/td
```


## Local proxy

The proxy is allinged to the intermediary specified in the WoT achitecture document. It can aggregate multiple WoT devices and maintain the device information inside.
The proxy can keep TDs of things that cannot be accessed from others due to suspended or sleeping, and can behave them instead of the physical devices.

This proxy has supported the local discovery mechanism using mDNS. You can find the detail interface and sequence diagram in https://github.com/w3c/wot-discovery/blob/master/prior-work/fujitsu/README.md.

### discovery of local proxy

To search this proxy, browse `_wot._tcp` service on plugfest VPN.

```
% avahi-browse -r _wot._tcp
+ vpn_vpn IPv4 wot-directory                                 _wot._tcp            local
= vpn_vpn IPv4 wot-directory                                 _wot._tcp            local
   hostname = [192-168-30-10.local]
   address = [192.168.30.10]
   port = [80]
   txt = ["register=/Things/register" "retrieve=/Things"]
```

This information shows you how to register and retrieve TDs to/from the proxy. The TDs retrieved from it are the virtual devices instead of the physical devices. 

### registry of new divice

First, a new WoT device is requied to register to the proxy. After this, applications can get and operate TDs of devices to be registered before.

```
curl -X POST -H 'content-type: application/json' -d '<TD>' http://192.168.30.10/Things/register
```


### retrieving registered TDs

To get device list of registered IDs

```
curl http://192.168.30.10/Things
```

To get a TD

```
curl http://192.168.30.10/Things/'ID'
```
